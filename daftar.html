<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Pesanan - BAZAR HmI</title>
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/svg+xml" href="assets/img/favicon.svg">
    <link rel="icon" href="assets/img/favicon-32.png" sizes="32x32">
    <link rel="icon" href="assets/img/favicon-16.png" sizes="16x16">
    <link rel="apple-touch-icon" href="assets/img/favicon-32.png">
</head>
<body>
    <!-- Removed immediate redirect so non-admins can login via modal -->
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top" style="box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html" style="font-size: 1.5rem;">
                <img src="logo.png" alt="HmI Logo" height="35" class="me-2">
                <span style="color: #0d6efd;">BAZAR</span> <span style="color: #000;">HmI</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html" style="color: #495057; font-weight: 500;">Beranda</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="pesan.html" style="color: #495057; font-weight: 500;">Pesan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="pesanan-saya.html" style="color: #495057; font-weight: 500;">Pesanan Saya</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="daftar.html" style="color: #495057; font-weight: 500;">Daftar</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a href="pesan.html" class="btn btn-primary btn-sm px-4" style="background: #17a2b8; border: none; border-radius: 6px;">Buat Pesanan</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5" id="adminContentContainer" style="display: none;">
        <div class="mb-5">
            <h1 class="display-5 fw-bold mb-3" style="color: #1a3a52;">üìã Daftar Pesanan</h1>
            <p class="lead text-muted">Kelola semua pesanan yang masuk dengan mudah</p>
        </div>

        <!-- Access Denied Message for Non-Admin -->
        <div id="accessDeniedMsg" class="alert alert-warning alert-dismissible fade show text-center" style="border-radius: 8px; display: none;">
            <h5 style="color: #856404; font-weight: 600;">‚ö†Ô∏è Akses Terbatas</h5>
            <p class="mb-2" style="color: #856404;">Halaman ini hanya untuk admin. Silakan login sebagai admin untuk mengakses daftar pesanan.</p>
            <button type="button" class="btn btn-warning btn-sm" onclick="location.reload();" style="font-weight: 600;">üîÑ Refresh & Login</button>
        </div>

        <div class="card shadow-lg border-0 mb-4" style="border-radius: 12px;">
            <div class="card-header" style="background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%); color: white; border-radius: 12px 12px 0 0;">
                <h5 class="mb-0" style="font-weight: 600;">üìä Pesanan yang Masuk</h5>
            </div>
            <div class="card-body p-4">
                <div class="table-responsive">
                    <table id="orderTable" class="table table-hover">
                        <thead style="background-color: #f8f9fb;">
                            <tr>
                                <th style="color: #1a3a52; font-weight: 600;">Nama Pembeli</th>
                                <th style="color: #1a3a52; font-weight: 600;">Meja</th>
                                <th style="color: #1a3a52; font-weight: 600;">Item</th>
                                <th style="color: #1a3a52; font-weight: 600;">Jumlah</th>
                                <th style="color: #1a3a52; font-weight: 600;">Total</th>
                                <th style="color: #1a3a52; font-weight: 600;">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="orderList">
                            <!-- Pesanan akan ditampilkan di sini -->
                        </tbody>
                    </table>
                </div>
                <div id="noOrdersMsg" class="alert alert-info text-center" style="border-radius: 8px;">
                    <p class="mb-0">Belum ada pesanan. <a href="pesan.html" style="color: #17a2b8; font-weight: 600;">Buat pesanan baru</a></p>
                </div>
            </div>
        </div>

        <!-- Admin Settings Section -->
        <div class="card shadow-lg border-0" style="border-radius: 12px; display: none;" id="adminSettingsCard">
            <div class="card-header" style="background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%); color: white; border-radius: 12px 12px 0 0;">
                <h5 class="mb-0" style="font-weight: 600;">üîí Pengaturan Admin</h5>
            </div>
            <div class="card-body p-4">
                <h6 class="fw-bold mb-3" style="color: #1a3a52;">Ubah Password Admin</h6>
                <form id="changePasswordForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold" style="color: #1a3a52;">Password Baru:</label>
                            <input type="password" id="newPassword" class="form-control" placeholder="Masukkan password baru" required>
                            <small class="text-muted d-block mt-1">Minimal 6 karakter</small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold" style="color: #1a3a52;">Konfirmasi Password:</label>
                            <input type="password" id="confirmPassword" class="form-control" placeholder="Ulangi password baru" required>
                        </div>
                    </div>
                    <button type="submit" class="btn mt-3" style="background: #6f42c1; color: white; font-weight: 600; border-radius: 8px;">
                        üîê Ubah Password
                    </button>
                </form>
                <hr class="my-4">
                <button id="logoutAdminBtn" class="btn btn-danger w-100" style="font-weight: 600; border-radius: 8px;">
                    üö™ Logout Admin
                </button>
            </div>
        </div>

        <!-- Export/Import Section -->
        <div class="card shadow-lg border-0" style="border-radius: 12px;">
            <div class="card-header" style="background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%); color: white; border-radius: 12px 12px 0 0;">
                <h5 class="mb-0" style="font-weight: 600;">üìä Kelola Data</h5>
            </div>
            <div class="card-body p-4">
                <div class="row g-3">
                    <div class="col-md-6">
                        <button type="button" id="exportBtn" class="btn btn-lg w-100" style="background: #17a2b8; color: white; font-weight: 600; border-radius: 8px;">
                            üì• Export ke Excel
                        </button>
                    </div>
                    <div class="col-md-6">
                        <input type="file" id="importFile" class="form-control" accept=".xlsx,.xls,.csv" style="display:none;">
                        <button type="button" id="importBtn" class="btn btn-lg w-100" style="background: #ffc107; color: #000; font-weight: 600; border-radius: 8px;">
                            üì§ Import dari Excel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Modal -->
        <div class="modal fade" id="editModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content" style="border-radius: 12px;">
                    <div class="modal-header" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: #000; border-radius: 12px 12px 0 0;">
                        <h5 class="modal-title fw-bold">Edit Pesanan</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div id="editContent"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="button" class="btn btn-primary" id="saveEditBtn" style="background: #17a2b8; border: none;">Simpan Perubahan</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div><!-- Close adminContentContainer -->

    <!-- Admin Login Modal (shown to non-admin visitors) -->
    <div class="modal fade" id="adminPromptModal" tabindex="-1">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content" style="border-radius:12px;">
                <div class="modal-header">
                    <h5 class="modal-title">Login Admin</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted">Masuk untuk melihat daftar pesanan.</p>
                    <form id="modalAdminLoginForm">
                        <div class="mb-2">
                            <input id="modalAdminPassword" type="password" class="form-control" placeholder="Password admin" required>
                        </div>
                        <div class="d-grid">
                            <button class="btn btn-primary" type="submit">Login</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white py-5" style="background: #1a1a1a !important; border-top: 1px solid rgba(255,255,255,0.1);">
        <div class="container">
            <div class="row mb-5">
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5 class="fw-bold mb-3" style="color: white;">BAZAR HmI</h5>
                    <p style="color: #aaa;">Platform pemesanan makanan dan minuman yang mudah dan cepat.</p>
                </div>
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5 class="fw-bold mb-3" style="color: white;">Navigasi</h5>
                    <ul class="list-unstyled">
                        <li><a href="index.html" style="color: #aaa; text-decoration: none; transition: color 0.3s;">Beranda</a></li>
                        <li><a href="pesan.html" style="color: #aaa; text-decoration: none; transition: color 0.3s;">Pesan</a></li>
                        <li><a href="daftar.html" style="color: #aaa; text-decoration: none; transition: color 0.3s;">Daftar Pesanan</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5 class="fw-bold mb-3" style="color: white;">Panitia Pelaksana</h5>
                    <p style="color: #aaa; margin-bottom: 0.5rem;">RAKER & CAMP INTELEKTUAL</p>
                    <p style="color: #aaa; font-size: 0.9rem;">HmI Komisariat Handayani<br>Cabang Makassar</p>
                </div>
            </div>
            <hr style="border-color: rgba(255,255,255,0.1); margin: 2rem 0;">
            <div class="text-center">
                <p style="color: #aaa; margin-bottom: 0;">¬© 2024 BAZAR HmI - Himpunan Mahasiswa Islam Komisariat Handayani. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="admin-nav.js"></script>
    
    <!-- SheetJS - GUNAKAN CDN ALTERNATIF -->
    <script src="https://unpkg.com/xlsx@latest/dist/xlsx.full.min.js"></script>
    
    <!-- Script Aplikasi -->
    <script src="assets/js/api-config.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="script.js"></script>
        <script src="assets/js/realtime.js"></script>
    <script>
        // If user is not admin, show modal prompt; attach modal form to auth handler
        (function() {
            const isAdmin = sessionStorage.getItem('isAdmin') === '1';
            const adminModalEl = document.getElementById('adminPromptModal');
            if (!adminModalEl) return;
            const modal = new bootstrap.Modal(adminModalEl, { backdrop: 'static', keyboard: false });
            const form = document.getElementById('modalAdminLoginForm');
            if (!isAdmin) {
                modal.show();
            }
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const pwd = document.getElementById('modalAdminPassword').value || '';
                    const ok = await loginAdmin(pwd);
                    if (ok) {
                        modal.hide();
                        location.reload();
                    } else {
                        alert('Password salah.');
                    }
                });
            }
        })();
    </script>
</body>
</html>